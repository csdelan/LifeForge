@page "/"
@page "/character"
@using LifeForge.Domain

<PageTitle>Character Sheet</PageTitle>

<div class="character-sheet">
    <h1>Character Sheet</h1>

    @if (_character != null)
    {
        <div class="character-info">
            <h2>@_character.Name</h2>

            <div class="stats-grid">
                <div class="stat-section">
                    <h3>Attributes</h3>
                    <div class="stat-row">
                        <span class="stat-label">Strength:</span>
                        <span class="stat-value">@_character.Strength</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Discipline:</span>
                        <span class="stat-value">@_character.Discipline</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Focus:</span>
                        <span class="stat-value">@_character.Focus</span>
                    </div>
                </div>

                <div class="stat-section">
                    <h3>Resources</h3>
                    <div class="resource-bar">
                        <label>HP</label>
                        <div class="progress-bar">
                            <div class="progress-background hp-background"></div>
                            <div class="progress-fill hp-fill" style="width: @GetHPPercentage()%"></div>
                            <span class="progress-text">@_character.HP / @_character.HPMax</span>
                        </div>
                    </div>
                    <div class="resource-bar">
                        <label>MP</label>
                        <div class="progress-bar">
                            <div class="progress-background mp-background"></div>
                            <div class="progress-fill mp-fill" style="width: @GetMPPercentage()%"></div>
                            <span class="progress-text">@_character.MP / @_character.MPMax</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wealth-section">
                <h3>Wealth</h3>
                <div class="currency-list">
                    @foreach (var currency in _character.Currencies)
                    {
                        <div class="currency-item">
                            <span class="currency-name">@currency.Key:</span>
                            <span class="currency-amount">@currency.Value</span>
                        </div>
                    }
                    @if (!_character.Currencies.Any())
                    {
                        <p class="no-data">No currencies yet</p>
                    }
                </div>
            </div>

            <div class="classes-section">
                <h3>Classes</h3>
                <div class="class-list">
                    @foreach (var classProfile in _character.ClassProfiles)
                    {
                        <div class="class-item">
                            <h4>@classProfile.Value.Class.Name</h4>
                            <div class="class-details">
                                <span>Level: @classProfile.Value.Level</span>
                                <div class="xp-bar">
                                    <div class="progress-bar small">
                                        <div class="progress-fill xp-fill" style="width: @GetXPPercentage(classProfile.Value)%"></div>
                                        <span class="progress-text small">@classProfile.Value.CurrentXp / @classProfile.Value.XpToNextLevel</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    @if (!_character.ClassProfiles.Any())
                    {
                        <p class="no-data">No classes yet</p>
                    }
                </div>
            </div>

            <div class="buffs-section">
                <h3>Active Buffs</h3>
                <div class="buff-list">
                    @foreach (var buff in _character.ActiveBuffs)
                    {
                        <div class="buff-item @(buff.Buff.IsDebuff ? "debuff" : "buff")">
                            <span class="buff-name">@buff.Buff.Name</span>
                        </div>
                    }
                    @if (!_character.ActiveBuffs.Any())
                    {
                        <p class="no-data">No active buffs</p>
                    }
                </div>
            </div>
        </div>
    }
    else
    {
        <p>Loading character...</p>
    }
</div>

@code {
    private Character? _character;

    protected override void OnInitialized()
    {
        _character = CreateSampleCharacter();
    }

    private double GetHPPercentage()
    {
        if (_character == null || _character.HPMax == 0) return 0;
        return ((double)_character.HP / _character.HPMax) * 100;
    }

    private double GetMPPercentage()
    {
        if (_character == null || _character.MPMax == 0) return 0;
        return ((double)_character.MP / _character.MPMax) * 100;
    }

    private double GetXPPercentage(CharacterClassSnapshot classSnapshot)
    {
        if (classSnapshot.XpToNextLevel == 0) return 0;
        return ((double)classSnapshot.CurrentXp / classSnapshot.XpToNextLevel) * 100;
    }

    private Character CreateSampleCharacter()
    {
        var character = new Character("Hero of LifeForge")
        {
            HP = 75,
            HPMax = 100,
            MP = 40,
            MPMax = 80,
            Strength = 15,
            Discipline = 12,
            Focus = 18
        };

        character.Currencies[CurrencyType.Gold] = 1250;
        character.Currencies[CurrencyType.Karma] = 350;
        character.Currencies[CurrencyType.DesignWorkslot] = 5;

        var developerClass = new CharacterClass("Developer");
        character.ClassProfiles["Developer"] = new CharacterClassSnapshot(developerClass, 5, 350);

        var traderClass = new CharacterClass("Trader");
        character.ClassProfiles["Trader"] = new CharacterClassSnapshot(traderClass, 3, 120);

        var strengthBuff = new Buff
        {
            Name = "Focused Mind",
            IsDebuff = false,
            Description = "Increased focus from good sleep"
        };
        character.ActiveBuffs.Add(new BuffInstance(strengthBuff));

        var debuff = new Buff
        {
            Name = "Tired",
            IsDebuff = true,
            Description = "Reduced stats from lack of sleep"
        };
        character.ActiveBuffs.Add(new BuffInstance(debuff));

        return character;
    }
}
